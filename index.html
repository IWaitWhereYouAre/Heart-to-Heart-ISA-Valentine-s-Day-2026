<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Heart to Heart | Atelier ISA</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400&family=Pinyon+Script&display=swap');

    :root {
      --gold: #c5a059;
      --deep-green: #1a2a1d;
      --cream: #f8f5f0;
      --card-white: #ffffff;
      --border-soft: rgba(197, 160, 89, 0.3);
    }

    body {
      background-color: var(--cream);
      color: var(--deep-green);
      font-family: 'Lato', sans-serif;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      background-image: url("https://www.transparenttextures.com/patterns/natural-paper.png");
    }

    /* petals */
    .petal {
      position: fixed;
      top: -10%;
      z-index: 1;
      pointer-events: none;
      animation: fall linear infinite;
      background: white;
      border-radius: 150% 0 150% 0;
      opacity: 0.35;
      filter: blur(1px);
    }
    @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }

    #app-container {
      text-align: center;
      max-width: 100%;
      z-index: 10;
      padding: 20px;
    }

    .deck-area {
      position: relative;
      height: 300px;
      width: 300px;
      margin: 0 auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .card {
      position: absolute;
      width: 160px;
      height: 230px;
      background: var(--card-white);
      border-radius: 4px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.8s cubic-bezier(0.2, 1, 0.3, 1);
    }
    .card-inner-design {
      position: absolute;
      inset: 12px;
      border: 1px solid var(--gold);
      background-color: var(--deep-green);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card-inner-design svg { width: 40px; fill: var(--gold); opacity: 0.9; }

    #result-screen {
      display: none;
      opacity: 0;
      transition: 1s ease;
    }

    #capture-frame {
      background: var(--card-white);
      padding: 45px;
      width: 350px;
      height: 480px;
      margin: 0 auto;
      position: relative;
      border: 1px solid var(--border-soft);
      box-shadow: 0 40px 80px rgba(0,0,0,0.12);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-image: url("https://www.transparenttextures.com/patterns/paper-fibers.png");
    }

    #capture-frame::before {
      content: '';
      position: absolute;
      inset: 18px;
      border: 0.5px solid var(--gold);
      opacity: 0.4;
      pointer-events: none;
      z-index: 1;
    }

    .isa-header {
      font-size: 0.5rem;
      letter-spacing: 5px;
      color: var(--gold);
      text-transform: uppercase;
      margin-bottom: 15px;
      z-index: 4;
      font-weight: bold;
    }

    .name-section { margin-bottom: 30px; width: 100%; z-index: 4; }
    .for-label {
      font-family: 'Playfair Display', serif;
      font-size: 0.75rem;
      font-style: italic;
      color: #aaa;
    }
    .user-name-input {
      font-family: 'Pinyon Script', cursive;
      font-size: 2.2rem;
      border: none;
      border-bottom: 0.5px solid var(--border-soft);
      text-align: center;
      color: var(--deep-green);
      background: transparent;
      width: 80%;
      outline: none;
      margin-top: 2px;
    }

    .quote-box {
      font-family: 'Playfair Display', serif;
      font-size: 1.3rem;
      font-style: italic;
      line-height: 1.6;
      margin-top: auto;
      padding: 0 25px;
      z-index: 6;
      color: #1a1a1a;
    }
    .quote-author {
      font-size: 0.55rem;
      letter-spacing: 4px;
      text-transform: uppercase;
      opacity: 0.5;
      margin-top: 15px;
      margin-bottom: auto;
      z-index: 6;
    }

    .rec-row {
      width: 100%;
      display: flex;
      justify-content: space-between;
      border-top: 0.3px solid #ddd;
      padding-top: 20px;
      margin-top: 30px;
      text-align: left;
      z-index: 6;
    }
    .rec-label {
      font-size: 0.45rem;
      color: var(--gold);
      letter-spacing: 2px;
      font-weight: 700;
    }
    .rec-val {
      font-family: 'Playfair Display', serif;
      font-size: 0.7rem;
      display: block;
      margin-top: 4px;
      font-style: italic;
    }

    /* ======= DECORATIONS (UPDATED: luxe stationery set) ======= */
    .decoration-svg{
      position:absolute;
      cursor:move;
      user-select:none;
      pointer-events:auto;
      mix-blend-mode:multiply;

      width: 84px;
      height: 84px;

      opacity: 0.78;
      filter: saturate(0.95);
      transition: transform 0.08s;
      z-index: 3;
    }
    .decoration-svg.decoration-sparkle{
      width: 34px;
      height: 34px;
      opacity: 0.55;
      z-index: 5;
    }
    .decoration-svg.decoration-seal{
      width: 96px;
      height: 96px;
      opacity: 0.85;
      z-index: 4;
    }
    .decoration-svg.decoration-corner{
      width: 92px;
      height: 92px;
      opacity: 0.72;
      z-index: 4;
    }
    .decoration-svg.decoration-divider{
      width: 140px;
      height: 40px;
      opacity: 0.40;
      z-index: 2; /* behind quote */
      pointer-events: auto;
    }

    .atelier-toolbar {
      margin-top: 25px;
      display: inline-flex;
      gap: 12px;
      background: rgba(255,255,255,0.96);
      padding: 12px 18px;
      border-radius: 6px;
      border: 0.5px solid var(--gold);
      backdrop-filter: blur(6px);
    }
    .tool-btn {
      width: 44px;
      height: 44px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: 0.18s;
    }
    .tool-btn:hover { background: rgba(197,160,89,0.08); }
    .tool-btn svg { width: 26px; height: 26px; fill: none; stroke: var(--gold); }

    .btn-group { margin-top: 30px; }
    .btn {
      background: none;
      border: 0.5px solid var(--gold);
      padding: 10px 25px;
      text-transform: uppercase;
      letter-spacing: 3px;
      font-size: 0.6rem;
      cursor: pointer;
      transition: 0.3s;
      margin: 0 5px;
    }
    .btn-save { background: var(--gold); color: white; }
    .btn:hover { background: var(--deep-green); color: white; }
    .hint { font-size: 0.55rem; opacity: 0.4; margin-top: 15px; letter-spacing: 2px; text-transform: uppercase; }
  </style>
</head>

<body>
  <div id="app-container">
    <div id="ritual-screen">
      <p style="letter-spacing: 5px; font-size: 0.55rem; opacity: 0.6;">ATELIER ISA CHULALONGKORN</p>
      <h1 style="font-family: 'Pinyon Script', cursive; font-size: 5.5rem; color: var(--gold); margin: 0;">Heart to Heart</h1>
      <p style="letter-spacing: 8px; text-transform: uppercase; font-size: 0.75rem; margin-bottom: 40px;">Divine Selection</p>
      <div class="deck-area" id="deck-container"></div>
      <p id="status-text" style="letter-spacing: 3px; font-size: 0.6rem; margin-top: 30px; opacity: 0.7;">TAP TO SHUFFLE INTENTIONS</p>
    </div>

    <div id="result-screen">
      <div id="capture-frame">
        <div class="isa-header">Atelier ISA Correspondence</div>

        <div class="name-section">
          <span class="for-label">Dedicated to</span><br />
          <input type="text" class="user-name-input" placeholder="Name" maxlength="22" />
        </div>

        <div class="quote-box" id="quote-text"></div>
        <div class="quote-author" id="quote-source"></div>

        <div class="rec-row">
          <div class="rec-item">
            <span class="rec-label">CINEMATIC</span>
            <span class="rec-val" id="movie-title"></span>
          </div>
          <div class="rec-item" style="text-align: right;">
            <span class="rec-label">LITERARY</span>
            <span class="rec-val" id="book-title"></span>
          </div>
        </div>
      </div>

      <!-- UPDATED: curated stationery toolbar -->
      <div class="atelier-toolbar">
        <!-- Corner Filigree -->
        <div class="tool-btn" onclick="spawnDecoration('corner')" title="Corner Filigree">
          <svg viewBox="0 0 24 24">
            <path d="M5 19c2.8-7 6.8-11 14-14" stroke-width="1.2" stroke-linecap="round"/>
            <path d="M6.5 17.5c2.4-4.9 5.9-8.1 11.2-10.9" stroke-width="1.2" stroke-linecap="round" opacity="0.75"/>
            <path d="M8.2 18.2c0-1.6 1.1-2.7 2.6-2.7 1.2 0 2.2.7 2.2 1.8 0 .9-.8 1.6-1.8 1.6" stroke-width="1.2" stroke-linecap="round"/>
          </svg>
        </div>

        <!-- Wax Seal -->
        <div class="tool-btn" onclick="spawnDecoration('seal')" title="Wax Seal">
          <svg viewBox="0 0 24 24">
            <path d="M12 3.2
                     C13 3.2 13.3 4.1 14.2 4.4
                     C15.1 4.7 16 4.2 16.7 4.9
                     C17.4 5.6 16.9 6.5 17.2 7.4
                     C17.5 8.3 18.4 8.6 18.4 9.6
                     C18.4 10.6 17.5 10.9 17.2 11.8
                     C16.9 12.7 17.4 13.6 16.7 14.3
                     C16 15 15.1 14.5 14.2 14.8
                     C13.3 15.1 13 16 12 16
                     C11 16 10.7 15.1 9.8 14.8
                     C8.9 14.5 8 15 7.3 14.3
                     C6.6 13.6 7.1 12.7 6.8 11.8
                     C6.5 10.9 5.6 10.6 5.6 9.6
                     C5.6 8.6 6.5 8.3 6.8 7.4
                     C7.1 6.5 6.6 5.6 7.3 4.9
                     C8 4.2 8.9 4.7 9.8 4.4
                     C10.7 4.1 11 3.2 12 3.2Z"
                  stroke-width="1.2" stroke-linejoin="round"/>
          </svg>
        </div>

        <!-- Divider -->
        <div class="tool-btn" onclick="spawnDecoration('divider')" title="Divider">
          <svg viewBox="0 0 24 24">
            <path d="M4 12h16" stroke-width="1.2" stroke-linecap="round"/>
            <path d="M10.2 12c.5-1.3 1.1-2 1.8-2 .7 0 1.3.7 1.8 2" stroke-width="1.2" opacity="0.7"/>
          </svg>
        </div>

        <!-- Sparkle -->
        <div class="tool-btn" onclick="spawnDecoration('sparkle')" title="Sparkle">
          <svg viewBox="0 0 24 24">
            <path d="M12 6.2l.8 3.3 3.2.8-3.2.8-.8 3.3-.8-3.3-3.2-.8 3.2-.8.8-3.3Z"
                  stroke-width="1.2" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn" onclick="location.reload()">Reset</button>
        <button class="btn btn-save" onclick="saveImage()">Download Card</button>
      </div>
      <p class="hint">Double-click to rotate decorations</p>
    </div>
  </div>

  <script>
    const colorPalette = [
      { hex: "#fffdf0", quote: "To love at all is to be vulnerable.", source: "C.S. Lewis", movie: "Shadowlands", book: "The Four Loves" },
      { hex: "#fce3e3", quote: "Everything that frightens us wants our love.", source: "Rainer Maria Rilke", movie: "The Shape of Water", book: "Letters to a Young Poet" },
      { hex: "#f5ead0", quote: "Love is not blind; it sees more, not less.", source: "Erich Fromm", movie: "In the Mood for Love", book: "A Lover's Discourse" },
      { hex: "#e2ede4", quote: "The world is full of magic things.", source: "W.B. Yeats", movie: "Song of the Sea", book: "The Wind Among the Reed" },
      { hex: "#e8e1f5", quote: "It is not necessary to hurry intimacy.", source: "Anne Carson", movie: "Before Sunset", book: "Eros the Bittersweet" }
    ];

    let shuffleState = 0;
    const deck = document.getElementById('deck-container');

    const fleurSVG = `
      <svg viewBox="0 0 24 24">
        <path d="M12,21C11,21 9,20 9,18C9,17 10,16 11,15C8,15 5,14 5,11C5,9 6,5 12,2C18,5 19,9 19,11C19,14 16,15 13,15C14,16 15,17 15,18C15,20 13,21 12,21M12,14C14.5,14 16.5,13 17,11C17,9.5 16,7 12,4.5C8,7 7,9.5 7,11C7.5,13 9.5,14 12,14Z"/>
      </svg>
    `;

    function createDeck() {
      for (let i = 0; i < 8; i++) {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.zIndex = i;
        card.style.transform = `translate(${i}px, ${i}px)`;
        card.innerHTML = `<div class="card-inner-design">${fleurSVG}</div>`;
        card.onclick = () => (shuffleState < 3 ? runShuffle() : revealCard());
        deck.appendChild(card);
      }
    }

    function runShuffle() {
      shuffleState++;
      const cards = document.querySelectorAll('.card');
      cards.forEach(c => {
        c.style.transform =
          `translate(${(Math.random() - 0.5) * 300}px, ${(Math.random() - 0.5) * 300}px) rotate(${(Math.random() - 0.5) * 90}deg)`;
      });
      document.getElementById('status-text').innerText = `SHUFFLING (${shuffleState}/3)`;
      if (shuffleState === 3) setTimeout(fanCards, 700);
    }

    function fanCards() {
      shuffleState = 4;
      const cards = document.querySelectorAll('.card');
      cards.forEach((c, i) => {
        const angle = (i - 3.5) * 12;
        const x = (i - 3.5) * 42;
        c.style.transform = `translate(${x}px, 10px) rotate(${angle}deg)`;
      });
      document.getElementById('status-text').innerText = "SELECT AN INTENTION";
    }

    function revealCard() {
      const data = colorPalette[Math.floor(Math.random() * colorPalette.length)];
      document.getElementById('ritual-screen').style.opacity = '0';
      setTimeout(() => {
        document.getElementById('ritual-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        document.body.style.backgroundColor = data.hex;
        document.getElementById('quote-text').innerText = data.quote;
        document.getElementById('quote-source').innerText = `â€” ${data.source}`;
        document.getElementById('movie-title').innerText = data.movie;
        document.getElementById('book-title').innerText = data.book;
        setTimeout(() => (document.getElementById('result-screen').style.opacity = '1'), 50);
      }, 800);
    }

    /* ======= UPDATED: luxe stationery motifs ======= */
    const svgPaths = {
      corner: `
        <path d="M6 18c2.5-6.5 6-10.2 12-12" />
        <path d="M7.2 16.8c2.2-4.6 5.2-7.6 9.9-10.2" opacity="0.75"/>
        <path d="M8.2 15.2c1.1-1.4 2.3-2.6 3.8-3.6" opacity="0.55"/>

        <path d="M8.2 18c0-1.6 1.1-2.7 2.6-2.7 1.2 0 2.2.7 2.2 1.8 0 .9-.8 1.6-1.8 1.6" opacity="0.9"/>
        <path d="M12.8 12.6c0-1.6 1.1-2.7 2.6-2.7 1.2 0 2.2.7 2.2 1.8 0 .9-.8 1.6-1.8 1.6" opacity="0.85"/>

        <path d="M10.1 14.4c-.8-.1-1.4-.5-1.7-1.1.8.1 1.4.4 1.9.9" opacity="0.7"/>
        <path d="M12 12.6c-.8-.1-1.4-.5-1.7-1.1.8.1 1.4.4 1.9.9" opacity="0.7"/>
        <path d="M13.9 10.8c-.8-.1-1.4-.5-1.7-1.1.8.1 1.4.4 1.9.9" opacity="0.7"/>
      `,

      divider: `
        <path d="M6.5 12h11" opacity="0.35"/>
        <path d="M10.3 12c.5-1.3 1.1-2 1.7-2 .7 0 1.3.7 1.7 2" opacity="0.45"/>
        <path d="M10.3 12c.5 1.3 1.1 2 1.7 2 .7 0 1.3-.7 1.7-2" opacity="0.45"/>
        <path d="M9 12c.2-.9.6-1.3 1.1-1.3.6 0 1 .4 1.3 1.3" opacity="0.35"/>
        <path d="M15 12c-.2-.9-.6-1.3-1.1-1.3-.6 0-1 .4-1.3 1.3" opacity="0.35"/>
        <circle cx="12" cy="12" r="0.75" opacity="0.55"/>
      `,

      seal: `
        <path d="M12 3.2
                 C13 3.2 13.3 4.1 14.2 4.4
                 C15.1 4.7 16 4.2 16.7 4.9
                 C17.4 5.6 16.9 6.5 17.2 7.4
                 C17.5 8.3 18.4 8.6 18.4 9.6
                 C18.4 10.6 17.5 10.9 17.2 11.8
                 C16.9 12.7 17.4 13.6 16.7 14.3
                 C16 15 15.1 14.5 14.2 14.8
                 C13.3 15.1 13 16 12 16
                 C11 16 10.7 15.1 9.8 14.8
                 C8.9 14.5 8 15 7.3 14.3
                 C6.6 13.6 7.1 12.7 6.8 11.8
                 C6.5 10.9 5.6 10.6 5.6 9.6
                 C5.6 8.6 6.5 8.3 6.8 7.4
                 C7.1 6.5 6.6 5.6 7.3 4.9
                 C8 4.2 8.9 4.7 9.8 4.4
                 C10.7 4.1 11 3.2 12 3.2Z" />

        <path d="M12 5.1c2.4 0 4.5 2 4.5 4.5S14.4 14 12 14 7.5 12 7.5 9.6 9.6 5.1 12 5.1Z" opacity="0.55"/>

        <path d="M9.3 12.7L12 6.4l2.7 6.3" opacity="0.95"/>
        <path d="M10.3 10.9h3.4" opacity="0.8"/>

        <path d="M8.1 9.1c.4-1.6 1.7-2.7 3.9-2.7" opacity="0.22"/>
        <path d="M15.9 10.1c-.4 1.6-1.7 2.7-3.9 2.7" opacity="0.22"/>
      `,

      sparkle: `
        <path d="M12 6.2l.8 3.3 3.2.8-3.2.8-.8 3.3-.8-3.3-3.2-.8 3.2-.8.8-3.3Z"/>
        <path d="M17.6 7.4l.35 1.4 1.35.35-1.35.35-.35 1.4-.35-1.4-1.35-.35 1.35-.35.35-1.4Z" opacity="0.55"/>
      `
    };

    function spawnDecoration(type) {
      const container = document.getElementById('capture-frame');
      const wrapper = document.createElement('div');
      wrapper.className = 'decoration-svg';

      if (type === 'sparkle') wrapper.classList.add('decoration-sparkle');
      if (type === 'seal') wrapper.classList.add('decoration-seal');
      if (type === 'corner') wrapper.classList.add('decoration-corner');
      if (type === 'divider') wrapper.classList.add('decoration-divider');

      const W = container.clientWidth;
      const H = container.clientHeight;

      // curated positions (so it looks designed, not random stickers)
      const presets = {
        corner:  { x: 12,        y: 14,        r: 0 },                // top-left
        seal:    { x: W/2 - 48,  y: H - 138,   r: 0 },                // bottom-center
        divider: { x: W/2 - 70,  y: 238,       r: 0 },                // behind quote
        sparkle: { x: W - 58,    y: 206,       r: 0 }                 // near quote edge
      };
      const p = presets[type] || { x: W/2 - 40, y: H/2 - 40, r: 0 };

      wrapper.style.left = `${p.x}px`;
      wrapper.style.top  = `${p.y}px`;

      // IMPORTANT: unique gradient id per decoration (prevents ID collisions)
      const gid = `goldGrad_${Math.random().toString(16).slice(2)}`;

      const isSeal = type === "seal";
      const fillVal = isSeal ? "rgba(197,160,89,0.06)" : "none";
      const strokeW = isSeal ? 0.9 : 0.85;

      wrapper.innerHTML = `
        <svg viewBox="0 0 24 24" style="width:100%; height:100%;">
          <defs>
            <linearGradient id="${gid}" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#c5a059"/>
              <stop offset="45%" stop-color="#f4e4bc"/>
              <stop offset="100%" stop-color="#a67c33"/>
            </linearGradient>
          </defs>
          <g
            stroke="url(#${gid})"
            fill="${fillVal}"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="${strokeW}"
          >
            ${svgPaths[type]}
          </g>
        </svg>
      `;

      // subtle rotation only (luxury tilt)
      const rotationSteps = [0, 6, -6, 10, -10];
      let stepIndex = 0;
      let rot = p.r || 0;

      let active = false, initialX = 0, initialY = 0, xOffset = 0, yOffset = 0;

      wrapper.addEventListener("dblclick", () => {
        stepIndex = (stepIndex + 1) % rotationSteps.length;
        rot = rotationSteps[stepIndex];
        wrapper.style.transform = `translate(${xOffset}px, ${yOffset}px) rotate(${rot}deg)`;
      });

      wrapper.addEventListener("mousedown", (e) => {
        initialX = e.clientX - xOffset;
        initialY = e.clientY - yOffset;
        active = true;
      });

      document.addEventListener("mousemove", (e) => {
        if (!active) return;
        xOffset = e.clientX - initialX;
        yOffset = e.clientY - initialY;
        wrapper.style.transform = `translate(${xOffset}px, ${yOffset}px) rotate(${rot}deg)`;
      });

      document.addEventListener("mouseup", () => active = false);

      container.appendChild(wrapper);
    }

    function createPetal() {
      const p = document.createElement('div');
      p.className = 'petal';
      p.style.left = Math.random() * 100 + 'vw';
      p.style.width = (Math.random() * 8 + 4) + 'px';
      p.style.height = (Math.random() * 8 + 4) + 'px';
      p.style.animationDuration = (Math.random() * 5 + 5) + 's';
      document.body.appendChild(p);
      setTimeout(() => p.remove(), 8000);
    }
    setInterval(createPetal, 700);

    function saveImage() {
      html2canvas(document.getElementById('capture-frame'), { scale: 3, useCORS: true }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'Atelier_ISA_Private_Correspondence.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }

    createDeck();
  </script>
</body>
</html>
